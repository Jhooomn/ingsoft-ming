<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="bo.ucb.edu.ingsoft.dao.UserDao">
    <select id="findByUserId" resultType="bo.ucb.edu.ingsoft.models.User">
        SELECT
               username as userName,
               email as email,
               password as password,
               id_country as idCountry
        FROM users
        WHERE
            id_user=#{idUser};
    </select>

    <insert id="createPublisher" parameterType="bo.ucb.edu.ingsoft.models.User">
        INSERT INTO users
        VALUES (
            null,
            #{idCountry},
            #{userName},
            #{password},
            #{email},
            1,
            null,
            null,
            null,
            null,
            1,
            #{txId},
            #{txHost},
            #{txUserId},
            #{txDate}
        )
    </insert>
    <update id="updateUser" parameterType="bo.ucb.edu.ingsoft.models.User">
        UPDATE users
        SET  id_country=#{idCountry},
            username=#{userName},
            password=#{password},
            email=#{email},
            tx_id=#{txId},
            tx_host=#{txHost},
            tx_user_id=#{txUserId},
            tx_date=#{txDate}
        WHERE
            id_user=#{idUser}
    </update>
    <select id="listUserMails" resultType="bo.ucb.edu.ingsoft.models.User">
        SELECT
               id_user as idUser,
               email as email
        FROM users
        WHERE
            user_type=1
    </select>

    <select id="publisherMail" resultType="bo.ucb.edu.ingsoft.models.User">
        SELECT
               users.email as email
        FROM users inner join publishers
        on
            users.id_user = publishers.id_user
        where
        publishers.id_user=#{idUser}
    </select>

    <insert id="userSignUp" parameterType="bo.ucb.edu.ingsoft.models.User">
        INSERT INTO users
        VALUES (
            null,
            29,
            #{userName},
            #{password},
            #{email},
            0,
            null,
            null,
            null,
            #{alias},
            1,
            #{txId},
            #{txHost},
            #{txUserId},
            #{txDate}
        )
    </insert>

    <select id="userProfileInfo" resultType="bo.ucb.edu.ingsoft.models.User">
        SELECT
                username as userName,
                alias as alias,
                email as email,
                id_country as idCountry,
                photo_path as photoPath
        FROM users
        WHERE
            id_user=#{idUser};
    </select>

    <select id="userInfo" resultType="bo.ucb.edu.ingsoft.models.User">
        SELECT
                alias as alias,
                email as email,
                id_country as idCountry,
                photo_path as photoPath
        FROM users
        WHERE
            id_user=#{idUser};
    </select>

    <select id="userPassword" resultType="bo.ucb.edu.ingsoft.models.User">
        SELECT
                password as password
        FROM users
        WHERE
            id_user=#{idUser};
    </select>

    <select id="findUsersCountries" resultType="bo.ucb.edu.ingsoft.models.User">
        SELECT
                id_country as idCountry
        FROM users
        WHERE
            id_user in
            <foreach collection="list" item="item" index="index"
                            open="(" separator="," close = ")">
        #{item}
    </foreach>
    </select>

    <update id="updateUserInfo" parameterType="bo.ucb.edu.ingsoft.models.User">
        UPDATE users
        SET  alias=#{alias},
            email=#{email},
            id_country=#{idCountry},
            tx_id=#{txId},
            tx_host=#{txHost},
            tx_user_id=#{txUserId},
            tx_date=#{txDate}
        WHERE
            id_user=#{idUser}
    </update>

    <update id="updateUserPassword" parameterType="bo.ucb.edu.ingsoft.models.User">
        UPDATE users
        SET  password=#{password}
        WHERE
            id_user=#{idUser}
    </update>

    <select id="getLastInsertId" resultType="java.lang.Integer">
        SELECT LAST_INSERT_ID()
    </select>

    <update id="deleteUserPublisher">
        UPDATE users
        SET  status=0
        WHERE
            id_user=#{idUser}
    </update>
</mapper>
